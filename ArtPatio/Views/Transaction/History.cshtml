@{
    ViewData["Title"] = "Transaction History";
}


@model List<ArtPatio.Models.Transaction>
@using ArtPatio.Repositories
@inject IConfiguration Configuration

@functions {
    // Function to fetch artwork by ArtId
    private Artwork GetArtwork(int? artId)
    {
        if (artId == null) return null;

        var artworkRepository = new ArtworkRepository(Configuration); // Pass the injected configuration
        var artwork = artworkRepository.GetArtworkById(artId.Value);
        return artwork; // Return the Artwork object if found
    }
}

<h2 class="text-center my-4">Transaction History</h2>

@if (Model.Count == 0)
{
    <div class="alert alert-warning text-center" role="alert">
        No transaction history available.
    </div>
}
else
{
    <table class="table table-striped table-bordered text-center">
        <thead class="thead-light">
            <tr>
                <th scope="col">Transaction Date</th>
                <th scope="col">Type</th>
                <th scope="col">Previous Balance</th>
                <th scope="col">Updated Balance</th>
                <th scope="col">Artwork Details</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var transaction in Model)
            {
                <tr>
                    <td>@transaction.TransactionDate.ToString("g")</td>
                    <td>
                        <span class="badge @(transaction.TransactionType == "Credit" ? "bg-success" : "bg-danger")">
                            @transaction.TransactionType
                        </span>
                    </td>
                    <td>৳@transaction.PreviousBalance.ToString()</td>
                    <td>৳@transaction.UpdatedBalance.ToString()</td>
                    <td>
                        @if (transaction.ArtId != null)
                        {
                            var artwork = GetArtwork(transaction.ArtId);
                            if (artwork != null)
                            {
                                <div class="d-flex flex-column align-items-center">
                                    <img src="@Url.Content(artwork.ArtImage)" alt="Artwork Image" class="img-fluid rounded" style="max-width: 100px; max-height: 100px;" />
                                    <span class="mt-2 fw-bold">@artwork.ArtName</span>
                                </div>
                            }
                            else
                            {
                                <span class="text-muted">No image available</span>
                            }
                        }
                        else
                        {
                            <span class="text-muted">No artwork associated</span>
                        }
                    </td>
                </tr>
            }
        </tbody>
    </table>
}
